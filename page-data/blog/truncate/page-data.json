{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/truncate","result":{"data":{"markdownRemark":{"fields":{"longDate":"May 6, 2012"},"frontmatter":{"title":"truncating blog posts in Jekyll"},"html":"<p>I was working on my <a href=\"https://github.com/mojombo/jekyll\">Jekyll</a> <a href=\"/blog\">blog</a> page and noticed some funky output. It turns out that the content variable returns rendered HTML, and the truncate filter in <a href=\"https://github.com/Shopify/liquid\">Liquid</a> was cutting it off in the middle of a &#x3C;ul> element. I had previously thought the filter operated on the unrendered markdown content.</p>\n<p>I wanted a way to just display the first part of longer posts for the blog page without breaking/invalidating my HTML. I googled around and found a couple of hacks, but they seemed unnecessarily complicated. It turns out that a split function was added to the Liquid filters a few months back, so what you can do is insert an HTML comment into your posts, <a href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String/split\">split</a> on the comment, and just display the first element of the resulting array. If you don't need to truncate, it will display the full post. I had to update my local Jekyll to get the (not so) new split function.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo gem update</code></pre></div>\n<!--break-->\n<p>With the truncate filter, it will break in the middle of an HTML node</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{% for post in site.posts limit:10 %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post-preview<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ post.url }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ post.title }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post-date<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ post.date | date: \"%B %d, %Y\" }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    {% if post.content.size > 2000 %} {{ post.content | truncatewords: 300 }}\n    <span class=\"token comment\">&lt;!-- bad! content gives you rendered html and you will truncate in the middle of a node --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ post.url }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>read more<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n    {% else %} {{ post.content }} {% endif %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span> <span class=\"token punctuation\">/></span></span>\n{% endfor %}</code></pre></div>\n<p>Updated code with the split filter</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{% for post in site.posts limit:10 %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post-preview<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ post.url }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ post.title }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post-date<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ post.date | date: \"%B %d, %Y\" }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    {{ post.content | split:'<span class=\"token comment\">&lt;!--break--></span>' | first }} {% if post.content\n    contains '<span class=\"token comment\">&lt;!--break--></span>' %}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ post.url }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>read more<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n    {% endif %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span> <span class=\"token punctuation\">/></span></span>\n{% endfor %}</code></pre></div>\n<p>In your posts file, put your marker wherever you want to cut off the post for the main blog page</p>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\"><span class=\"token hr punctuation\">---</span>\nlayout: post\n<span class=\"token title important\">title: truncate example\n<span class=\"token punctuation\">---</span></span>\n\nParagraph 1\nParagraph 2\n\n<span class=\"token comment\">&lt;!--break--></span>\n\nParagraph 3\nParagraph 4</code></pre></div>\n<p>UPDATE: Well now, this worked perfectly fine on local Jekyll, but after pushing to github pages, <a href=\"https://github.com/mojombo/jekyll/issues/502\">it doesn't work</a>. I guess for now, I will resort to one of the aforementioned <a href=\"http://kaspa.rs/2011/04/jekyll-hacks-html-excerpts/\">hacks</a>.</p>\n<p>UPDATE#2: Apparently this works now on GH pages. Thanks <a href=\"http://adamralph.com/2013/01/09/blog-post-excerpts-a-new-solution/#update1\">Adam Ralph</a>.</p>","timeToRead":2}},"pageContext":{"id":"72b9af80-0cfc-505b-85d1-2120283bf040"}}}