---
layout: post
title: truncating blog posts in Jekyll
---

I was working on my [Jekyll](https://github.com/mojombo/jekyll) [blog](/blog) page and noticed some funky output. It turns out that the content variable returns rendered HTML, and the truncate filter in [Liquid](https://github.com/Shopify/liquid) was cutting it off in the middle of a &lt;ul&gt; element. I had previously thought the filter operated on the unrendered markdown content.

I wanted a way to just display the first part of longer posts for the blog page without breaking/invalidating my HTML. I googled around and found a couple of hacks, but they seemed unnecessarily complicated. It turns out that a split function was added to the Liquid filters a few months back, so what you can do is insert an HTML comment into your posts, [split](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String/split) on the comment, and just display the first element of the resulting array. If you don't need to truncate, it will display the full post. I had to update my local Jekyll to get the (not so) new split function.

<pre class="prettyprint">sudo gem update</pre>

<!--break-->

{% raw %}
<pre class="prettyprint linenums lang-html">&lt;!-- using the truncate filter --&gt;
{% for post in site.posts limit:10 %}
   &lt;h2&gt;&lt;a href=&quot;{{ post.url }}&quot;&gt;{{ post.title }}&lt;/a&gt;&lt;/h2&gt;
   &lt;span class=&quot;post-date&quot;&gt;{{ post.date | date: &quot;%B %d, %Y&quot; }}&lt;/span&gt;
   {% if post.content.size &gt; 2000 %}
      {{ post.content | truncatewords: 300 }} &lt;!-- bad! content gives you rendered html and you will truncate in the middle of a node --&gt;
      &lt;a href=&quot;{{ post.url }}&quot;&gt;read more&lt;/a&gt;
   {% else %}
      {{ post.content }}
   {% endif %}
   &lt;hr&gt;
{% endfor %}</pre>

<pre class="prettyprint linenums lang-html">&lt;!-- using the split filter --&gt;
{% for post in site.posts limit:10 %}
   &lt;div class=&quot;post-preview&quot;&gt;
   &lt;h2&gt;&lt;a href=&quot;{{ post.url }}&quot;&gt;{{ post.title }}&lt;/a&gt;&lt;/h2&gt;
   &lt;span class=&quot;post-date&quot;&gt;{{ post.date | date: &quot;%B %d, %Y&quot; }}&lt;/span&gt;
   {{ post.content | split:'&lt;!--break--&gt;' | first }}
   {% if post.content contains '&lt;!--break--&gt;' %}
      &lt;a href=&quot;{{ post.url }}&quot;&gt;read more&lt;/a&gt;
   {% endif %}
   &lt;/div&gt;
   &lt;hr&gt;
{% endfor %}</pre>

<pre class="prettyprint linenums lang-html">&lt;!-- In your posts file, put your marker wherever you want to cut off the post for the main blog page --&gt;
---
layout: post
title: truncate example
---

Paragraph 1

Paragraph 2

&lt;!--break--&gt;

Paragraph 3

Paragraph 4</pre>
{% endraw %}

UPDATE: Well now, this worked perfectly fine on local Jekyll, but after pushing to github pages, [it doesn't work](https://github.com/mojombo/jekyll/issues/502). I guess for now, I will resort to one of the aforementioned [hacks](http://kaspa.rs/2011/04/jekyll-hacks-html-excerpts/).

<!--end-->
