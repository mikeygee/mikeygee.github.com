<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.493e6315ef3a09bc2f74.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.21.9"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#f92672"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=2d478e5cbd2bbd58896af10b6eb0297c"/><style data-styled="esoegh IbjuF llxFiF  hMsMVO kYYiKR hVDKEM" data-styled-version="4.4.1">
/* sc-component-id: sc-global-4270002495 */
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;color:#292929;} body *,body *:before,body *:after{box-sizing:inherit;} @media (max-width:479px){body{font-size:13px;}} body a{color:#f92672;-webkit-text-decoration:none;text-decoration:none;} body a:hover{-webkit-text-decoration:underline;text-decoration:underline;} body blockquote{padding:0 1em;border-left:.25em solid #ddd;}
/* sc-component-id: components__StyledHomeLogo-sc-1hgu7df-1 */
.IbjuF{border:2px solid;border-radius:4px;padding:0 4px;color:#e6db74;font-size:1.1em;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;} .IbjuF span:first-child{color:#f92672;} .IbjuF span:nth-child(2){color:#ae81ff;}
/* sc-component-id: components__StyledFixedNav-sc-1hgu7df-3 */
.esoegh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:-webkit-sticky;position:sticky;top:0;margin-top:-140px;background-color:#292929;z-index:2;min-height:45px;position:fixed;width:100%;margin-top:0;} .esoegh ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:0;padding:0;} .esoegh ul > li{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;list-style-type:none;margin:0 0.5em;} @media (max-width:479px){.esoegh ul > li{margin:0 0.25em;}} .esoegh ul > li:first-child{margin-right:1.6em;} @media (max-width:479px){.esoegh ul > li:first-child{margin-right:0.8em;}} .esoegh ul > li:first-child > a{color:#e6db74;} .esoegh ul > li:nth-child(n + 2):nth-child(-n + 4){border-right:1px solid #f5f5f5;padding-right:1em;} @media (max-width:479px){.esoegh ul > li:nth-child(n + 2):nth-child(-n + 4){padding-right:0.5em;}} .esoegh ul > li a{text-transform:uppercase;color:#66d9ef;font-size:1.1em;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;} @media (max-width:479px){.esoegh ul > li a{font-size:0.85em;}}
/* sc-component-id: components__StyledPost-sc-1hgu7df-5 */
.kYYiKR{line-height:1.45;margin-bottom:40px;} .kYYiKR h2{font-size:1.5em;} .kYYiKR h4{font-size:1.2em;} .kYYiKR small{color:#777;margin-left:0.25em;} .kYYiKR pre{overflow:hidden;} .kYYiKR code{white-space:pre-wrap;} .kYYiKR iframe[src*='youtube']{width:100%;height:57vw;max-height:383px;}
/* sc-component-id: components__BlogContainer-sc-1hgu7df-7 */
.hMsMVO{margin:0 auto;max-width:680px;font-family:Charter,Georgia,'Times New Roman',serif;}
/* sc-component-id: components__StyledFooter-sc-1hgu7df-9 */
.hVDKEM{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;font-size:0.8em;padding:1em;background-color:#292929;color:#f5f5f5;} .hVDKEM > span{margin:0 0.5em;} .hVDKEM > span a{color:#f5f5f5;}
/* sc-component-id: BlogPost__Container-sc-1w1iaqs-0 */
.llxFiF{min-height:calc(100vh - 113px);padding:0 2em;margin-top:65px;} @media (max-width:479px){.llxFiF{min-height:calc(100vh - 109px);}}</style><title data-react-helmet="true">Mikey Gee | scraping with node.js</title><link as="script" rel="preload" href="/component---src-templates-blog-post-js-ace17839d66cd9c844dc.js"/><link as="script" rel="preload" href="/commons-08d5c7573c75d5fe2746.js"/><link as="script" rel="preload" href="/95b64a6e-f16d9efd4455c2bb2292.js"/><link as="script" rel="preload" href="/app-f1fa61999664426e6f1c.js"/><link as="script" rel="preload" href="/framework-4f6f95a87e6130d5bbab.js"/><link as="script" rel="preload" href="/styles-9c180fe55942c37c6859.js"/><link as="script" rel="preload" href="/webpack-runtime-9c7b2d24c33183120c14.js"/><link as="fetch" rel="preload" href="/page-data/blog/scrape2/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><nav class="components__StyledNav-sc-1hgu7df-2 components__StyledFixedNav-sc-1hgu7df-3 esoegh"><ul><li><a class="components__StyledHomeLogo-sc-1hgu7df-1 IbjuF" href="/"><span>M</span><span>G</span></a></li><li><a href="/#about">About</a></li><li><a href="/#work">Work</a></li><li><a href="/#contact">Contact</a></li><li><a href="/#blog">Blog</a></li></ul></nav><div class="BlogPost__Container-sc-1w1iaqs-0 llxFiF"><section class="components__BlogContainer-sc-1hgu7df-7 hMsMVO"><div class="components__StyledPost-sc-1hgu7df-5 kYYiKR"><h2>scraping with node.js</h2><h4>June 21, 2013<!-- --> <small>3<!-- --> min read</small></h4><div><p>Last year, I wrote a <a href="/blog/scrape">post about web scraping</a>. The app I was working on was using PHP, so the HTML parsing code required a library that is probably not too well known. Since then I've started using node.js more, which makes scraping much easier. I thought I'd do another example with node, where it's possible to use the more common jQuery syntax for HTML parsing.</p>
<p>For this example, I'll be scraping song lyrics from <a href="http://lyrics.wikia.com">LyricWiki</a>. By exploring the site, I found that the URL pattern for a given track is <a href="http://lyrics.wikia.com/%5C%5Bartist%5C_name%5C%5D:%5C%5Btrack%5C_name%5C%5D">http://lyrics.wikia.com/\[artist\_name\]:\[track\_name\]</a>. So for this example, I'll pass the artist and track as arguments to my script.</p>
<!--break-->
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> artist <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> track <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>artist <span class="token operator">||</span> <span class="token operator">!</span>track<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Usage: node lyrics_scrape.js [artist] [track]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'http://lyrics.wikia.com/'</span> <span class="token operator">+</span> artist <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> track<span class="token punctuation">;</span></code></pre></div>
<p>Next I include a couple of node libraries for fetching the html, and parsing HTML with jquery syntax.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// npm install request</span>
<span class="token keyword">var</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// npm install cheerio</span></code></pre></div>
<p>There are a couple options for the parser library. <a href="https://github.com/tmpvar/jsdom">jsdom</a> will give you a full W3C DOM environment to work with, which has quite a bit of overhead. You can then load the actual jQuery library, and start using it. <a href="https://github.com/MatthewMueller/cheerio">Cheerio</a> uses a simpler DOM, and implements a subset of the jQuery API without all the extra browser dependent code, resulting in much better performance. This is a more appropriate solution for scraping.</p>
<p>After we load the libraries, we request the URL, pass the HTML to cheerio, and start parsing out the information we want. I target the div with class "lyricbox", remove a couple of nodes that I don't want, replace &#x3C;br>'s with newlines, and grab the text. For my application, I wanted the lyrics as an array of lines. Here's the rest of the script.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> response<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div.lyricbox > .rtMatcher, div.lyricbox > .lyricsbreak'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div.lyricbox > br'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> lyrics <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div.lyricbox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lyrics<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Then we run it on the command line:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&gt; node lyrics_scrape.js weezer &quot;only in dreams&quot;

[ &#39;You can\&#39;t resist her&#39;,
  &#39;She\&#39;s in your bones&#39;,
  &#39;She is your marrow&#39;,
  &#39;And your ride home&#39;,
  &#39;&#39;,
  &#39;You can\&#39;t avoid her&#39;,
  &#39;She\&#39;s in the air&#39;,
  &#39;In between molecules of&#39;,
  &#39;Oxygen and carbon dioxide&#39;,
  &#39;&#39;,
  &#39;Only in dreams&#39;,
  &#39;We see what it means&#39;,
  &#39;Reach out our hands&#39;,
  &#39;Hold on to hers&#39;,
  &#39;But when we wake&#39;,
  &#39;It\&#39;s all been erased&#39;,
  &#39;And so it seems&#39;,
  &#39;Only in dreams&#39;,
  &#39;&#39;,
  &#39;You walk up to her&#39;,
  &#39;Ask her to dance&#39;,
  &#39;She says, &quot;Hey, baby&#39;,
  &#39;I just might take the chance&quot;&#39;,
  &#39;&#39;,
  &#39;You say it\&#39;s a good thing&#39;,
  &#39;That you float in the air&#39;,
  &#39;That way there\&#39;s no way&#39;,
  &#39;I will crush your pretty toenails into a thousand pieces&#39;,
  &#39;&#39;,
  &#39;Only in dreams&#39;,
  &#39;We see what it means&#39;,
  &#39;Reach out our hands&#39;,
  &#39;Hold on to hers&#39;,
  &#39;But when we wake&#39;,
  &#39;It\&#39;s all been erased&#39;,
  &#39;And so it seems&#39;,
  &#39;Only in dreams&#39;,
  &#39;&#39;,
  &#39;Only in dreams&#39;,
  &#39;Only in dreams&#39;,
  &#39;Only in dreams&#39;,
  &#39;Only in dreams&#39;,
  &#39;Only in dreams&#39;,
  &#39;Only in dreams&#39;,
  &#39;&#39;,
  &#39;&#39;,
  &#39;&#39; ]</code></pre></div>
<p>And that's it, much simpler than the PHP library, and using the same language and syntax as the browser. My workflow now is to start in the browser, use the <a href="http://www.learningjquery.com/2009/04/better-stronger-safer-jquerify-bookmarklet">jQuerify</a> bookmarklet to add jQuery to any web page. Then you can experiment in the browser console and once you have your selectors figured out, transfer them over to the node server.</p></div></div></section></div><footer class="components__StyledFooter-sc-1hgu7df-9 hVDKEM"><span>Â© 2020 Mikey Gee</span><span><a href="https://github.com/mikeygee/mikeygee.github.com" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="2em" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9 1.4.3 2.6.4 3.8.4 8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1-8.4 1.9-15.9 2.7-22.6 2.7-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1 10.5 0 20-3.4 25.6-6 2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8 0 0 1.6-.5 5-.5 8.1 0 26.4 3.1 56.6 24.1 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 30.2-21 48.5-24.1 56.6-24.1 3.4 0 5 .5 5 .5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5 1.2 0 2.6-.1 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"></path></svg></a></span></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-25946924-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/scrape2";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f1fa61999664426e6f1c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-d8f0963af69a8bfa7f94.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c2db2e07e3ccdc75a1ca.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-ace17839d66cd9c844dc.js"]};/*]]>*/</script><script src="/webpack-runtime-9c7b2d24c33183120c14.js" async=""></script><script src="/styles-9c180fe55942c37c6859.js" async=""></script><script src="/framework-4f6f95a87e6130d5bbab.js" async=""></script><script src="/app-f1fa61999664426e6f1c.js" async=""></script><script src="/95b64a6e-f16d9efd4455c2bb2292.js" async=""></script><script src="/commons-08d5c7573c75d5fe2746.js" async=""></script><script src="/component---src-templates-blog-post-js-ace17839d66cd9c844dc.js" async=""></script></body></html>